FROM swift:5.0

RUN apt-get -qq update && apt-get install -y \
  libssl-dev zlib1g-dev libsqlite3-dev \
  && rm -r /var/lib/apt/lists/*

WORKDIR /app
ADD . ./
RUN swift package clean
RUN swift build -c release
RUN mkdir /app/bin
RUN mv `swift build -c release --show-bin-path` /app/bin
EXPOSE 8080
ENTRYPOINT ./bin/release/Run serve -e prod -b 0.0.0.0
